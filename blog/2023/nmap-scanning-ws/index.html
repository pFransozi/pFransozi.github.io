<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>scanning web servers | pfransozi.github.io</title> <meta name="author" content="Philipe Fransozi"> <meta name="description" content="understanding some nmap powerful scripts to scan web servers"> <meta property="og:site_name" content="pfransozi.github.io"> <meta property="og:type" content="website"> <meta property="og:title" content="pfransozi.github.io | scanning web servers"> <meta property="og:url" content="https://pfransozi.github.io/blog/2023/nmap-scanning-ws/"> <meta property="og:description" content="understanding some nmap powerful scripts to scan web servers"> <meta property="og:locale" content="en"> <meta name="twitter:card" content="summary"> <meta name="twitter:title" content="scanning web servers"> <meta name="twitter:description" content="understanding some nmap powerful scripts to scan web servers"> <script type="application/ld+json">
      {
        "author":
        {
          "@type": "Person",
          "name": "Philipe  Fransozi"
        },
        "url": "https://pfransozi.github.io/blog/2023/nmap-scanning-ws/",
        "@type": "WebSite",
        "description": "understanding some nmap powerful scripts to scan web servers",
        "headline": "scanning web servers",
        "sameAs": ["https://tryhackme.com/p/OutroHomemComum", "https://github.com/pfransozi", "https://www.linkedin.com/in/philipehf"],
        "name": "Philipe  Fransozi",
        "@context": "https://schema.org"
      }
    </script> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.ico"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://pfransozi.github.io/blog/2023/nmap-scanning-ws/"> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">pfransozi.github.io</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/links/">links</a> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">scanning web servers</h1> <p class="post-meta">January 28, 2023</p> <p class="post-tags"> <a href="/blog/2023"> <i class="fas fa-calendar fa-sm"></i> 2023 </a>   ·   <a href="/blog/tag/nmap"> <i class="fas fa-hashtag fa-sm"></i> nmap</a>   <a href="/blog/tag/network"> <i class="fas fa-hashtag fa-sm"></i> network</a>   <a href="/blog/tag/reconnaissance"> <i class="fas fa-hashtag fa-sm"></i> reconnaissance</a>   </p> </header> <article class="post-content"> <h2 id="introduction">Introduction</h2> <p>One of the most powerful features of nmap is the nmap scripting engine (nse), which is an engine that allows to execute scripts that are developed using lua programming language, aiming to automate a wide variety of networking tasks.</p> <p>A group of those scripts is dedicated to http and they are used to find vulnerabilities and misconfiguration settings in web applications. This page, which is part of nmap project, focus on those scripts and techniques that are related to audit web servers and web penetration tests.</p> <p>To list scripts related to http, use: <code class="language-plaintext highlighter-rouge">ls -al /usr/share/nmap/scripts/ | grep http</code>. They are text-based, so you can open using a text editor.</p> <h2 id="scanning-web-services">Scanning Web Services</h2> <p>The next topics are based on the existence of a running web server, by default it can be running in 80, 443 ports, in public network. Nmap can verify if there is a web service running on those ports in many ways. One example is: <code class="language-plaintext highlighter-rouge">nmap -sS -sV -O -p80,443 scanme.nmap.org</code>. Considering public services, it’s common that they are running on their default ports. Otherwise, it may be required a deeper scanning to detect which port the service runs on, if any, such as <code class="language-plaintext highlighter-rouge">nmap -sS -sV -O -p1024-20000 -T4 scanme.nmap.org</code>.</p> <p>A brief analysis of those flags:</p> <ul> <li> <code class="language-plaintext highlighter-rouge">-sS</code> is tcp/syn scan that never completes tcp connection, which means a more unobtrusive, stealthy, and quickly way to scan. This mode requires privilege;</li> <li> <code class="language-plaintext highlighter-rouge">-sV</code> performs a service and version detection, as well as a service scan. If in a privilege mode will be a <code class="language-plaintext highlighter-rouge">-sS</code> flag, tcp/syn, otherwise in an unprivileged mode, service scan will be <code class="language-plaintext highlighter-rouge">-sT</code>, which means a complete tcp connection is a way opposed to <code class="language-plaintext highlighter-rouge">-sS</code>, more obtrusive, detectable, and slow;</li> <li> <code class="language-plaintext highlighter-rouge">-O</code> is os detection and it requires privilege mode as well;</li> <li> <code class="language-plaintext highlighter-rouge">-p80,443</code> specifies ports that are known to run http services;</li> <li> <code class="language-plaintext highlighter-rouge">-p1025-20000</code> specifies ports that are out of the default range. For a more aggressive approach it can be used <code class="language-plaintext highlighter-rouge">-p-</code> which will scan all 65535 ports;</li> <li> <code class="language-plaintext highlighter-rouge">-T4</code> specifies a timing template known as aggressive, but it can be adjusted from <code class="language-plaintext highlighter-rouge">-T0</code> to <code class="language-plaintext highlighter-rouge">-T5</code> depends on the network from the command is sent and the target network.</li> <li> <code class="language-plaintext highlighter-rouge">scanme.nmap.org</code> is used for tests, but when you have a target, you must change it to your target;</li> </ul> <p>That command returns something like this:</p> <pre><code class="language-log">Starting Nmap 7.93 ( https://nmap.org ) at 2022-12-23 23:34 UTC
Nmap scan report for scanme.nmap.org (45.33.32.156)
Host is up (0.26s latency).
Other addresses for scanme.nmap.org (not scanned): 2600:3c01::f03c:91ff:fe18:bb2f

PORT    STATE    SERVICE VERSION
80/tcp  filtered http
443/tcp closed   https
Too many fingerprints match this host to give specific OS details

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 11.89 seconds
</code></pre> <p>No level of verbosity gives a bottom line result. Otherwise, there are several verbosity levels available in nmap, which are specified using <code class="language-plaintext highlighter-rouge">-v</code>, <code class="language-plaintext highlighter-rouge">-d</code>, and <code class="language-plaintext highlighter-rouge">-V</code> options followed by a number or a combination of the letters. The higher the verbosity level, the more detailed the output will be. Here is a breakdown of the available verbosity levels:</p> <ul> <li> <code class="language-plaintext highlighter-rouge">-v</code> is the default verbosity level, and it provides normal output with a summary at the end of the scan;</li> <li> <code class="language-plaintext highlighter-rouge">-vv</code> or <code class="language-plaintext highlighter-rouge">-v2</code> provides more detailed output, including the reason why each port was marked as open or closed;</li> <li> <code class="language-plaintext highlighter-rouge">-vvv</code> or <code class="language-plaintext highlighter-rouge">-v3</code> provides even more detailed output, including all of the packets sent and received during the scan;</li> <li> <code class="language-plaintext highlighter-rouge">-V</code> provides less output than the default, but includes version and os detection results;</li> <li> <code class="language-plaintext highlighter-rouge">-d</code> increases debugging output;</li> <li> <code class="language-plaintext highlighter-rouge">-dd</code> or <code class="language-plaintext highlighter-rouge">-d2</code> increases debugging output even further;</li> <li> <code class="language-plaintext highlighter-rouge">-ddd</code> or <code class="language-plaintext highlighter-rouge">-d3</code> increases debugging output to the maximum level;</li> </ul> <p>A multiple verbosity options can be used together, such as <code class="language-plaintext highlighter-rouge">-v</code> and <code class="language-plaintext highlighter-rouge">-d</code> to increase the level of detail in the output.</p> <h3 id="listing-supported-http-methods">Listing supported http methods</h3> <p><a href="https://nmap.org/nsedoc/scripts/http-methods.html" target="_blank" rel="external nofollow noopener">http-methods</a> is a kind of enumeration script, which is used to list all http methods available in an http server. The script code can be found <a href="https://github.com/nmap/nmap/blob/master/scripts/http-methods.nse" rel="external nofollow noopener" target="_blank">here</a>.</p> <p>The next command scans ports 80, 443, which are by default related to http and https, testing all http methods, which are get, head, post, options, delete, put, connect, trace, for http; and get, head, post, options, trace, connect, for https: <code class="language-plaintext highlighter-rouge">nmap -p80,443 --script http-methods --script-args http-methods.test-all=true insecure.org -d</code>.</p> <p>There are two main flags when using nmap and nse, which are <code class="language-plaintext highlighter-rouge">--script</code> and <code class="language-plaintext highlighter-rouge">--script-args</code>. The latest is used when the script allow to send parameters to it, as example: <code class="language-plaintext highlighter-rouge">--script-args='http-methods.test-all=true,http-methods.url-path=/mypath/'</code> In the case of the http-methods script, main parameters are:</p> <ul> <li> <code class="language-plaintext highlighter-rouge">http-methods.url-path</code> is the path to request and by default is <code class="language-plaintext highlighter-rouge">/</code>, or change it to <code class="language-plaintext highlighter-rouge">http-methods.url-path=/mypath/</code>;</li> <li> <code class="language-plaintext highlighter-rouge">http-methods.test-all</code> is a boolean field that test all methods even the unsafe ones;</li> <li> <code class="language-plaintext highlighter-rouge">http.useragent</code> changes the value of user-agent, which is by default <code class="language-plaintext highlighter-rouge">Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)</code>. To suppress that http field passes a empty string;</li> <li> <code class="language-plaintext highlighter-rouge">http-methods.retest</code>is used to test each method individually;</li> </ul> <p>By default, http-method script uses http options method to ask to the web server which are the http methods available for a specific resource, by default <code class="language-plaintext highlighter-rouge">/</code> root web path. When <code class="language-plaintext highlighter-rouge">http-methods.retest</code> parameter is used, nmap forge a request for each method and it analyzes the web server return. The options method is implemented in web servers to inform clients of its supported methods, but this method does not consider configuration or firewall rules, and having an http method listed by options does not necessarily mean that it is accessible to you.</p> <p>For example, without http-methods.retest the request is:</p> <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">OPTIONS</span> <span class="nn">/resource</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">www.example.com</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">MyClient/1.0</span>
</code></pre></div></div> <p>And a possible response is:</p> <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">Allow: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS
Content-Length: 0
Date: Mon, 21 May 2022 10:00:00 GMT
</span></code></pre></div></div> <p>With http-methods.retest, nmap generates a http request for each method and it will analyze each response status code, as follow:</p> <ul> <li> <strong>GET request</strong>:</li> </ul> <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/resource</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">www.example.com</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">MyClient/1.0</span>
</code></pre></div></div> <ul> <li> <strong>GET response</strong>:</li> </ul> <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/html</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">1234</span>
<span class="na">Date</span><span class="p">:</span> <span class="s">Mon, 21 May 2022 10:00:00 GMT</span>

<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;p&gt;</span>This is the content of the resource.<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div> <ul> <li> <strong>HEAD request</strong>:</li> </ul> <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">HEAD</span> <span class="nn">/resource</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">www.example.com</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">MyClient/1.0</span>
</code></pre></div></div> <ul> <li> <strong>HEAD response</strong>:</li> </ul> <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/html</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">1234</span>
<span class="na">Date</span><span class="p">:</span> <span class="s">Mon, 21 May 2022 10:00:00 GMT</span>
</code></pre></div></div> <ul> <li> <strong>POST request</strong>:</li> </ul> <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">POST</span> <span class="nn">/resource</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">www.example.com</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/x-www-form-urlencoded</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">25</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">MyClient/1.0</span>

key1=value1&amp;key2=value2
</code></pre></div></div> <ul> <li> <strong>POST response</strong>:</li> </ul> <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">/resource/123</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/html</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">0</span>
<span class="na">Date</span><span class="p">:</span> <span class="s">Mon, 21 May 2022 10:00:00 GMT</span>
</code></pre></div></div> <ul> <li> <strong>PUT request</strong>:</li> </ul> <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">PUT</span> <span class="nn">/resource/123</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">www.example.com</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">45</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">MyClient/1.0</span>

<span class="p">{</span><span class="nl">"key1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"key2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value2"</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <ul> <li> <strong>PUT response</strong>:</li> </ul> <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/html</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">0</span>
<span class="na">Date</span><span class="p">:</span> <span class="s">Mon, 21 May 2022 10:00:00 GMT</span>
</code></pre></div></div> <ul> <li> <strong>DELETE request</strong>:</li> </ul> <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">DELETE</span> <span class="nn">/resource/123</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">www.example.com</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">MyClient/1.0</span>
</code></pre></div></div> <ul> <li> <strong>DELETE response</strong>:</li> </ul> <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/html</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">0</span>
<span class="na">Date</span><span class="p">:</span> <span class="s">Mon, 21 May 2022 10:00:00 GMT</span>
</code></pre></div></div> <ul> <li> <strong>TRACE request</strong>:</li> </ul> <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">TRACE</span> <span class="nn">/resource</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">www.example.com</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">MyClient/1.0</span>
</code></pre></div></div> <ul> <li> <strong>TRACE response</strong>:</li> </ul> <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">message/http</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">123</span>
<span class="na">Date</span><span class="p">:</span> <span class="s">Mon, 21 May 2022 10:00:00 GMT</span>

TRACE /resource HTTP/1.1
Host: www.example.com
User-Agent: MyClient/1.0
</code></pre></div></div> <ul> <li><strong>CONNECT request</strong></li> </ul> <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">CONNECT example.com:443 HTTP/1.1
Host: example.com
User-Agent: MyClient/1.0
</span></code></pre></div></div> <ul> <li><strong>CONNECT response</strong></li> </ul> <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">Connection established</span>
</code></pre></div></div> <p>Return to the command above, let’s analyze its return. It starts with a ping scan, which is used to discover if the host is online, and dns resolution:</p> <pre><code class="language-log">Initiating Ping Scan at 00:51
Scanning insecure.org (45.33.49.119) [2 ports]
Completed Ping Scan at 00:51, 0.31s elapsed (1 total hosts)

mass_rdns: Using DNS server 181.213.132.2
mass_rdns: Using DNS server 181.213.132.3
Initiating Parallel DNS resolution of 1 host. at 00:51
mass_rdns: 0.58s 0/1 [#: 2, OK: 0, NX: 0, DR: 0, SF: 0, TR: 1]
Completed Parallel DNS resolution of 1 host. at 00:51, 0.58s elapsed
DNS resolution of 1 IPs took 0.58s. Mode: Async [#: 2, OK: 1, NX: 0, DR: 0, SF: 0, TR: 1, CN: 0]
</code></pre> <p>To skip ping scan <code class="language-plaintext highlighter-rouge">-Pn</code> flag can be used, and <code class="language-plaintext highlighter-rouge">-n</code> to skip dns resolution. Then, specified ports are tested and scripts are executed to discover all http methods:</p> <pre><code class="language-log">Initiating Connect Scan at 00:51
Scanning insecure.org (45.33.49.119) [2 ports]
Discovered open port 443/tcp on 45.33.49.119
Discovered open port 80/tcp on 45.33.49.119
Completed Connect Scan at 00:51, 0.24s elapsed (2 total ports)

NSE: Script scanning 45.33.49.119.
NSE: Starting runlevel 1 (of 1) scan.
Initiating NSE at 00:51
NSE: Starting http-methods against insecure.org (45.33.49.119:80).
NSE: Starting http-methods against insecure.org (45.33.49.119:443).
NSE: [http-methods 45.33.49.119:80] HTTP Status for OPTIONS is 301
NSE: [http-methods 45.33.49.119:80] No Allow or Public header in OPTIONS response (status code 301)
NSE: [http-methods 45.33.49.119:443] HTTP Status for OPTIONS is 200
NSE: [http-methods 45.33.49.119:80] Response Code to Random Method is 301
NSE: [http-methods 45.33.49.119:443] Response Code to Random Method is 501
NSE: Finished http-methods against insecure.org (45.33.49.119:443).
NSE: Finished http-methods against insecure.org (45.33.49.119:80).
Completed NSE at 00:51, 6.14s elapsed
</code></pre> <p>The results will include the supported methods for every web server detected on ports 80 or 443, as follow:</p> <pre><code class="language-log">PORT    STATE SERVICE REASON
80/tcp  open  http    syn-ack
| http-methods: 
|   Supported Methods: GET HEAD POST OPTIONS DELETE PUT CONNECT TRACE
|_  Potentially risky methods: DELETE PUT CONNECT TRACE
443/tcp open  https   syn-ack
| http-methods: 
|   Supported Methods: OPTIONS GET HEAD POST TRACE CONNECT
|_  Potentially risky methods: TRACE CONNECT
</code></pre> <p>Using this <code class="language-plaintext highlighter-rouge">http-methods.retest</code>, the result specifies each http method tested:</p> <pre><code class="language-log">PORT    STATE SERVICE REASON
80/tcp  open  http    syn-ack
| http-methods: 
|   Supported Methods: GET HEAD POST OPTIONS DELETE PUT CONNECT TRACE
|   Potentially risky methods: DELETE PUT CONNECT TRACE
|   Status Lines: 
|     HEAD: HTTP/1.1 301 Moved Permanently
|     TRACE: HTTP/1.1 301 Moved Permanently
|     DELETE: HTTP/1.1 301 Moved Permanently
|     POST: HTTP/1.1 301 Moved Permanently
|     PUT: HTTP/1.1 301 Moved Permanently
|     CONNECT: HTTP/1.1 400 Bad Request
|     GET: HTTP/1.1 301 Moved Permanently
|_    OPTIONS: HTTP/1.1 301 Moved Permanently
443/tcp open  https   syn-ack
| http-methods: 
|   Supported Methods: OPTIONS GET HEAD POST TRACE CONNECT
|   Potentially risky methods: TRACE CONNECT
|   Status Lines: 
|     HEAD: HTTP/1.1 200 OK
|     OPTIONS: HTTP/1.1 200 OK
|     CONNECT: HTTP/1.1 400 Bad Request
|     TRACE: HTTP/1.1 200 OK
|     GET: HTTP/1.1 200 OK
|_    POST: HTTP/1.1 200 OK
</code></pre> <p>Those methods are worthy of further discussion that goes beyond the context of this page, but let’s understand why nmap considers some of them a security risk.</p> <blockquote> <p>First of all, if the http-method script lists a method as potentially risk, it may not all be a risk and it must be check to make sure.</p> </blockquote> <blockquote> <p>Second of all, http-method script considers a risk: trace, connect, put and delete.</p> </blockquote> <blockquote> <p>Third of all, just for reference, rfc 9110 considers secure HTTP methods those that do not alter the state of the server, leading to a read-only operation. Thus, the client doesn’t request any server change</p> </blockquote> <p><strong>Trace method</strong> requests an application-level loop-back of the request message, back to the client from the web server as the content of a 200 (OK) response. Trace allows the client to see what is being received at the other end of the request chain.</p> <p>Historically, it could be used to bypass httponly cookie flag on cookies, vulnerability known as Cross Site Tracing, and was used to disclosure sensitive information from http headers that were restricted from javascript and cookies. <strong>That kind of attack is no longer possible in modern web browsers</strong>.</p> <p>Otherwise, it can lead to disclosure of sensitive information such as internal authentication headers appended by reverse proxies or web application firewalls in a way to bypass those such as <a href="https://www.blackhillsinfosec.com/three-minutes-with-the-http-trace-method/" rel="external nofollow noopener" target="_blank">this example</a>, using Burpsuite or ZAP.</p> <blockquote> <p>Anyway, the trace method should be disabled on production web servers even if only to comply one of the wisest security principles says that what is unused should be disabled.</p> </blockquote> <p><strong>Connect method</strong> requests a tunnel to the destination origin server by the web client and, if so, thereafter restricts its behavior to blind forwarding of data, until the tunnel is closed. Tunnels are primarily, but not exclusively, used in combination with the transport layer security (TLS) to create a secure connection between a client and a server to stablish an end-to-end encrypted session.</p> <blockquote> <p>Connect is intended for use in requests to a proxy server.</p> </blockquote> <p>It’s may be another historically issue, since I did not find any concrete explanation how http connection method can be exploited, except for 10-year-old references. Anyway, the main problem is, or was, that the http connect method can be abused to establish arbitrary TCP connections through vulnerable proxy services. That abuse could be: a vulnerable proxy service on one network as an intermediary to scan or connect to TCP services on another network; a connection from a public network, such as the Internet, through a vulnerable proxy service to an internal network; If a proxy service allows recursive connections, an attacker may be able to cause a denial-of-service condition by consuming resources by making repeated connections from the proxy service back to itself. But as I said, I didn’t find any recent reference about this problem, which could indicate that the modern proxy web server are not more vulnerable to this.</p> <p><strong>Put method</strong> requests that the state of the target resource be created or replaced with the state defined by the representation enclosed in the request message context. If the target resource does not have a current representation and the put successfully creates one, then the server must inform sending a 201 response. If the target resource does have a current representation and that representation is successfully modified in accordance with the state of the enclosed representation, then the server must send either a 200 or a 204 response. There’re as well as responses that reflects inconsistences with the target resource such as 409 or 415.</p> <p>It’s important to note that the put method is idempotent, which means that multiple identical put requests should have the same effect as a single request, and for that information is altered. Unlike post method, by which every request may have additional effects.</p> <p>Overwriting resource is a possible vulnerability related to put method, sending a put request to overwriting an existent resource in the server. Mass assignment is another vulnerability by which an attacker may change properties of an object that are not initially specified. And last but not least, since put is an input method it is vulnerable to injection attack, requiring properly sanitize and validate any user input.</p> <p><strong>Delete method</strong> requests that a resource be removed from the server. This method is idempotent and not reversible. Likewise put method and others input methods, delete is vulnerable to method misuse, since delete is not implemented properly and user can delete resources that they didn’t intend to delete. As well as an attacker can manipulate input data in a kind of injection attack.</p> <blockquote> <p>Overall, it’s important to be cautious when using input methods, making sure that you have proper authentication and authorization in place to prevent unauthorized access. It’s also a good idea to regularly audit your code and test for potential vulnerabilities. If trace and connect methods are not needed in production environment, so disable them.</p> </blockquote> <h3 id="discovering-interesting-files-and-folders-on-web-servers">Discovering interesting files and folders on web servers</h3> <p>Discovering files and directories is usually the next task done after discovering a web service running on a target. And it is a kind of task that need to be automated. Nmap has a stript called <code class="language-plaintext highlighter-rouge">http-enum</code>, which is used to enumerate files and directories used by popular web applications.</p> <p>There are several tools that perform this kind of task, and the main difference between them is the database, in which there are a combination of files names and directories. <code class="language-plaintext highlighter-rouge">Http-enum</code> has its own database, but allows to use nikto database, since a combination of popular directories and files names is set.</p> <p>According to the script (<code class="language-plaintext highlighter-rouge">/usr/share/nmap/script</code>), only pages that return <code class="language-plaintext highlighter-rouge">200 OK</code> or <code class="language-plaintext highlighter-rouge">401 Authentication Required</code> are listed, except when <code class="language-plaintext highlighter-rouge">http-enum.displayall</code> is set.</p> <p>The first step of the script is to test if the server return a proper <code class="language-plaintext highlighter-rouge">404 Not Found</code> status, using two random files. In the case of different results, the script aborts because it is not possible distinguish between a 200-looking 404 cannot be distinguished and an actual 200. If <code class="language-plaintext highlighter-rouge">301 Moved Permanently</code> or <code class="language-plaintext highlighter-rouge">401 Authentication Required</code>, then the script abort as well.</p> <p>The basic command starts with: <code class="language-plaintext highlighter-rouge">nmap -sV --script http-enum scanme.nmap.org</code>. As result:</p> <pre><code class="language-log">PORT      STATE    SERVICE    VERSION
22/tcp    open     ssh        OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.13 (Ubuntu Linux; protocol 2.0)
25/tcp    filtered smtp
80/tcp    open     http       Apache httpd 2.4.7 ((Ubuntu))
| http-enum: 
|   /images/: Potentially interesting directory w/ listing on 'apache/2.4.7 (ubuntu)'
|_  /shared/: Potentially interesting directory w/ listing on 'apache/2.4.7 (ubuntu)'
|_http-server-header: Apache/2.4.7 (Ubuntu)
1434/tcp  filtered ms-sql-m
9929/tcp  open     nping-echo Nping echo
31337/tcp open     tcpwrapped
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre> <p>By default, <code class="language-plaintext highlighter-rouge">http-enum</code> script uses the root directory, which is <code class="language-plaintext highlighter-rouge">/</code>. To change use <code class="language-plaintext highlighter-rouge">--script-args http-enum.basepath=</code>. Another useful args are: <code class="language-plaintext highlighter-rouge">--script-args http-enum.displayall</code> displays all file and directory tested, even the discarded ones. And <code class="language-plaintext highlighter-rouge">http-enum.fingerprintfile=</code>, which is used to define a specific fingerprint file.</p> <h3 id="brute-forcing">Brute forcing</h3> <p><code class="language-plaintext highlighter-rouge">http-brute</code> script is used to perform brute-force password auditing against web servers that are using http authentication, allowing robust dictionary attack against HTTP basic, digest, and NTLM authentication.</p> <p>The basic command is: <code class="language-plaintext highlighter-rouge">nmap -p80 --script http-brute scanme.nmap.org</code>. As result:</p> <pre><code class="language-log">
</code></pre> <p>By default, the script uses <code class="language-plaintext highlighter-rouge">usernames.lst</code> and <code class="language-plaintext highlighter-rouge">passwords.lst</code>, which are located at <code class="language-plaintext highlighter-rouge">/usr/shared/nmap/nselib/data/</code>. To change the reference lists, use <code class="language-plaintext highlighter-rouge">--script-args userdb=? usernames.txt,passdb=</code> arguments.</p> <p>Another interesting argument is <code class="language-plaintext highlighter-rouge">--script-args brute.firstOnly</code>, which is used to quit after finding one valid account.</p> <p>It is possible to perform a brute-force password auditing against web applications, using databases of popular web applications, such as wordpress, joomla!, django, drupal, mediawiki, websphere.</p> <p>The basic command is: <code class="language-plaintext highlighter-rouge">nmap --script http-form-brute -sV scanme.nmap.org</code>. as result:</p> <pre><code class="language-log">
</code></pre> <p>The script automatically attempts to detect the form fields required to authenticate into the web application, and it uses a database of popular applications internally to help during the form detection phase. If script does not detected the fields, <code class="language-plaintext highlighter-rouge">--script-args http-form-brute.passvar=?,http-form-brute.uservar=?</code> arguments can be used to set them manually.</p> <p>There are two specialized scripts for web application framework: <code class="language-plaintext highlighter-rouge">http-wordpress-brute</code> and <code class="language-plaintext highlighter-rouge">http-joomla-brute</code>. The joomla script will fetch a security token and include it in the login requests.</p> <h3 id="detecting-web-application-firewalls">Detecting web application firewalls</h3> <p><code class="language-plaintext highlighter-rouge">http-waf-detect</code> and <code class="language-plaintext highlighter-rouge">http-waf-fingerprint</code> are scripts for detecting traffic filtering system such as web application firewall or intrusion prevention system. It can be done because because there are different responses in the web application when a malicious payload is used, then the script compare a response from a save http request with a response from a request that containing attack payload. The http-waf-detect script uses a fingerprint database to recognize special headers and cookies in the responses to attempt to identify products.</p> <h3 id="detecting-possible-xst-vulnerabilities">Detecting possible XST vulnerabilities</h3> <p><code class="language-plaintext highlighter-rouge">nmap -sV --script http-methods,http-trace --script-args http-methods.retest scanme.nmap.org</code></p> <h3 id="detecting-xss-vulnerabilities">Detecting XSS vulnerabilities</h3> <p><code class="language-plaintext highlighter-rouge">nmap -sV --script http-unsafe-output-escaping scanme.nmap.org</code> <code class="language-plaintext highlighter-rouge">nmap -sV --script http-phpself-xss,http-unsafe-output-escaping scanme.nmap.org</code> <code class="language-plaintext highlighter-rouge">nmap -sV --script http-xssed scanme.nmap.org</code> (query online database xssed.com)</p> <h3 id="finding-sql-injection-vulnerabilities">Finding SQL injection vulnerabilities</h3> <p><code class="language-plaintext highlighter-rouge">nmap -sV --script http-sql-injection scanme.nmap.org</code></p> <h3 id="finding-web-applications-with-default-credentials">Finding web applications with default credentials</h3> <p><code class="language-plaintext highlighter-rouge">nmap -sV --script http-default-accounts scanme.nmap.org</code></p> <p>For a less intrusive scan, filter out probes by category using <code class="language-plaintext highlighter-rouge">http-default-accounts.category</code>.</p> <ul> <li>web: this category manages web applications;</li> <li>router: this category manages the interfaces of routers;</li> <li>voip: this category contains voip devices;</li> <li>security: this category manages security-related software;</li> <li>industrial: this category manages software related to industrial control systems (icses);</li> <li>printer: this category manages printer devices;</li> <li>storage: this category contains storage devices;</li> <li>virtualization: this category manages software for virtualization;</li> <li>console: this category contains remote consoles;</li> </ul> <h3 id="detecting-insecure-cross-domain-policies">Detecting insecure cross-domain policies</h3> <p><code class="language-plaintext highlighter-rouge">nmap --script http-cross-domain-policy scanme.nmap.org</code></p> <h3 id="detecting-exposed-source-code-control-systems">Detecting exposed source code control systems</h3> <p><code class="language-plaintext highlighter-rouge">nmap -sV --script http-git scanme.nmap.org</code> <code class="language-plaintext highlighter-rouge">nmap -sV --script http-svn-info scanme.nmap.org</code></p> <h3 id="auditing-the-strength-of-cipher-suites-in-ssl-servers">Auditing the strength of cipher suites in SSL servers</h3> <p><code class="language-plaintext highlighter-rouge">nmap --script ssl-enum-ciphers -sV scanme.nmap.org</code></p> <p>Other scripts:</p> <ul> <li>ssl-ccs-injection: This checks whether a server is vulnerable to CCS injection (CVE-2014-0224).</li> <li>ssl-cert: This obtains information about SSL certificates.</li> <li>ssl-dh-params: This checks whether a server is vulnerable to Logham (CVE-2015-4000).</li> <li>ssl-heartbleed: This checks whether a server is vulnerable to Heartbleed (CVE-2014-0160).</li> <li>ssl-poodle: This checks whether a server is vulnerable to Poodle (CVE-2014-3566).</li> <li>sslv2-drown: This checks whether a server is vulnerable to Drown (CVE-2015-3197, CVE-2016-0703, and CVE-2016-0800);</li> <li>ssl-cert-intaddr: Reports any private IP address found in the SSL certificate;</li> </ul> <h2 id="references">References</h2> <p><a href="https://www.rfc-editor.org/rfc/rfc9110.html" rel="external nofollow noopener" target="_blank">RFC 9110 - HTTP Semantics</a></p> <p><a href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP" rel="external nofollow noopener" target="_blank">developer.mozilla.org - HTTP</a></p> <p><a href="https://en.wikipedia.org/wiki/Same-origin_policy" rel="external nofollow noopener" target="_blank">wiki - Same Origin Policy</a></p> <p><a href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/06-Test_HTTP_Methods" rel="external nofollow noopener" target="_blank">owasp - Configuration_and_Deployment_Management_Testing/06-Test_HTTP_Methods</a></p> <p><a href="https://owasp.org/www-community/attacks/Cross_Site_Tracing" rel="external nofollow noopener" target="_blank">owasp - Cross_Site_Tracing</a></p> <p><a href="https://deadliestwebattacks.com/appsec/2010/05/18/cross-site-tracing-xst-the-misunderstood-vulnerability" rel="external nofollow noopener" target="_blank">Cross site tracing xst the misunderstood vulnerability</a></p> <p><a href="https://www.blackhillsinfosec.com/three-minutes-with-the-http-trace-method/" rel="external nofollow noopener" target="_blank">Three minutes with the http trace method</a></p> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 Philipe Fransozi. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Last updated: June 25, 2023. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>