---
layout: post
title:  THM AoC 2022 DAY TWO
date:   2022-12-08 09:00:00
description: walking through the second day's topics and diving deeper
tags: ["Log-Files", "Log-Analysis"]
category: ["Try-Hack-Me", "THM-AoC-2022", "Log-Analysis"]
---
## Introduction

The second day focuses on log analysis and the goals are:

* **what** log files are and **why** they're useful;
* **what** valuable information log files can contain;
* **where** log files can be found;
* and some **linux commands** to handle with text log files;

## Log files and log analysis

Log analysis is an important part of cybersecurity, since it can provide valuable insight into potential security threats, involving collection and analysis of various logs generated by various systems, networks, and applications to detect malicious activities and suspicious patterns. Log files can be used to detect intrusions, malware, malicious user activity, and operational errors. Through log analysis, organizations can identify potential security issues and take corrective measures to address them. Log analysis can also be used to detect patterns of malicious behavior and to track user activity for compliance purposes.

In general, log files record data of an event triggered by an application, such as:

* user logins and logouts;
* system startup and shutdown;
* application usage;
* configuration changes;
* security events;
* network traffic;
* system errors and warnings;
* user actions;
* resource utilization.

And, in general, data recorded is:

* What has happened?
* When has it happened?
* Where has it happened?
* Who did it? Were they successful?
* What is the result of this action?

Another important aspect of this topic is to know where the files are.

**In Windows**, log files are stored in:

~~~ cmd
%SystemRoot%\System32\Winevt\Logs\
%SystemRoot%\system32\config\
%SystemRoot%\system32\LogFiles\
~~~

Windows OS has an in-built application that allows to access historical records of events that happen. It is an utility that displays detailed information about significant events from the system, security and general applications.

* **system log** contains information about system-wide events, such as when a service starts or stops, or when a driver is installed.
* **application log** contains information about application events, such as when an application crashes or when an application writes an error to the log.
* **security log** contains information about security-related events, such as when a user logs on or off, or when a user attempts to access a resource.
* **setup log** contains information about the setup and configuration of Windows, such as when an application is installed or uninstalled.

Event viewer can be accessed using the command:

~~~ cmd
eventvwr
~~~

**In Linux**, the log files are stored in:

~~~ shell
/var/log
~~~

All file logs in Linux are created in that directory by default. Between those files, there are some important ones:

~~~ shell
/var/log/auth.log
/var/log/dpkg.log
/var/log/syslog
/var/log/kern.log
~~~

* **authentication** file contains all authentication (log in). This is usually attempted either remotely or on the system itself (i.e., accessing another user after logging in).
Example: failed password for root from 192.168.1.35 port 22 ssh2.
* **package management** contains all events related to package management on the system. When installing a new software (a package), this is logged in this file. This is useful for debugging or reverting changes in case this installation causes unintended behaviour on the system.
Example: 2022-06-03 21:45:59 installed neofetch.
* **syslog** contains all events related to things happening in the system's background. For example, crontabs executing, services starting and stopping, or other automatic behaviours such as log rotation. This file can help debug problems.
Example: 2022-06-03 13:33:7 Finished Daily apt download activities..
* **kernel** contains all events related to kernel events on the system. For example, changes to the kernel, or output from devices such as networking equipment or physical devices such as USB devices.
Example: 2022-06-03 10:10:01 Firewalling registered


<!-- Sure, the dmesg command is used to print or control the kernel message buffer in Linux. The kernel message buffer is a ring buffer that stores messages and logs generated by the kernel, drivers, and other components of the operating system. The dmesg command allows you to view these messages and logs in the terminal.

The sudo command is used to run a command with superuser (i.e. root) privileges. This is often necessary when using the dmesg command, as it requires access to the kernel message buffer, which is typically only accessible to the root user.

Here are what the commands you provided are doing:

sudo dmesg: This command prints the entire kernel message buffer to the terminal. This will display all messages and logs generated by the kernel, drivers, and other components of the operating system.

sudo dmesg | grep 'error': This command prints only the lines from the kernel message buffer that contain the word "error". This can be useful for filtering out specific messages or logs that you are interested in.

sudo dmesg | grep -i -E 'error|warn|failed': This command is similar to the previous one, but it uses the -i and -E flags to perform a case-insensitive search and to use regular expressions to match multiple patterns. In this case, the command will print lines that contain the words "error", "warn", or "failed", regardless of their case.

sudo dmesg | more: This command is similar to the first one, but it uses the more command to paginate the output of the dmesg command. This can be useful if the kernel message buffer is very long and doesn't fit on the screen. The more command allows you to view the output one page at a time, and use the space key to move to the next page, or the q key to quit. -->


### General application

~~~ shell
/var/log/mysql.log
/var/log/samba/
/var/log/maillog
/var/log/vsftpd.log
~~~

~~~ cmd
%SystemRoot%\system32\LogFiles\HTTPERR
%SystemRoot%\system32\LogFiles\RDP
%SystemRoot%\system32\LogFiles\DNS
%SystemRoot%\system32\LogFiles\DHCP
%SystemRoot%\system32\LogFiles\Kerberos
%SystemRoot%\system32\LogFiles\Firewall
~~~

~~~ shell
# /var/log/apache2/
# A client logs in 
127.0.0.1 - - [09/Dec/2022:15:00:01 +0000] "GET /login HTTP/1.1" 200 1412 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36"
127.0.0.1 - - [09/Dec/2022:15:00:23 +0000] "POST /login HTTP/1.1" 302 - "http://localhost/login" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36"
127.0.0.1 - - [09/Dec/2022:15:00:23 +0000] "GET /home HTTP/1.1" 200 2342 "http://localhost/login" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36"
127.0.0.1 - - [09/Dec/2022:15:00:31 +0000] "GET /image1.png HTTP/1.1" 200 3189 "http://localhost/home" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36"
127.0.0.1 - - [09/Dec/2022:15:00:40 +0000] "GET /image2.png HTTP/1.1" 200 4982 "http://localhost/home" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36"
~~~

---

~~~ shell
# /var/log/nginx/
# A client try to access /private/account.php not logged in, so it is redirected to /login.php
127.0.0.1 - - [09/Dec/2022:15:00:01 +0000] "GET /login HTTP/1.1" 200 1412 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36"
127.0.0.1 - - [09/Dec/2022:15:00:23 +0000] "POST /login HTTP/1.1" 401 - "http://localhost/login" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36"
~~~

### SIEM

SIEM stands for Security Information and Event Management. It is a type of software used to collect, store, analyze, and report on log data from multiple sources. SIEM helps organizations to monitor their IT environment for security threats, detect suspicious activity, and take corrective action. It can also be used to track user activity for compliance purposes. The two most common applications are: Splunk and ELK Stack.

In unix-based OS, there are very important tools to handle text files and for that log files as well. Some examples are:

* tail;
* head;
* less;
* grep, egrep, fgrep;
* find;
* locate;
* awk;
* touch;
* echo;

## References

### THM resources

[Splunk 101](https://tryhackme.com/room/splunk101){:target="_blank"}.

[Splunk 201](https://tryhackme.com/room/splunk201){:target="_blank"}.

[Intro SIEM](https://tryhackme.com/room/introtosiem){:target="_blank"}.

[Linux Fundamental 1](https://tryhackme.com/room/linuxfundamentalspart1){:target="_blank"}.

[Linux Fundamental 2](https://tryhackme.com/room/linuxfundamentalspart3){:target="_blank"}.

[Linux Fundamental 3](https://tryhackme.com/room/linuxfundamentalspart2){:target="_blank"}.

[Linux Modules](https://tryhackme.com/room/linuxmodules){:target="_blank"}.

### others resources

[Splunk](https://www.splunk.com/)

[ELK Stack](https://www.elastic.co/what-is/elk-stack)
